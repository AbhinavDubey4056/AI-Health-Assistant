<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Health AI - Your Personal Health Assistant</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      color: #e2e8f0;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Navbar Styles */
    .navbar {
      background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
      padding: 1rem 2rem;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
    }

    .navbar-brand { 
      color: #fff !important; 
      font-weight: 700; 
      font-size: 1.5rem; 
      display: flex; 
      align-items: center; 
      gap: 10px;
      transition: transform 0.2s;
    }
    
    .navbar-brand:hover {
      transform: scale(1.05);
    }
    
    .navbar-brand i { font-size: 1.8rem; }

    .menu-toggle {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .menu-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .btn-outline-light {
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.2s;
    }

    .btn-outline-light:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: white;
      transform: translateY(-2px);
    }

    /* Offcanvas Menu Styles */
    .offcanvas {
      background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
      border-right: 1px solid rgba(59, 130, 246, 0.2);
    }

    .offcanvas-header {
      border-bottom: 1px solid rgba(59, 130, 246, 0.2);
      padding: 1.5rem;
    }

    .offcanvas-title {
      color: #3b82f6;
      font-weight: 600;
    }

    .btn-close {
      filter: invert(1);
    }

    .menu-list {
      list-style: none;
      padding: 1rem;
    }

    .menu-item {
      padding: 1rem 1.5rem;
      margin-bottom: 0.5rem;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      color: #cbd5e1;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-item:before {
      content: "â€¢";
      font-size: 1.5rem;
      color: #3b82f6;
    }

    .menu-item:hover {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
      transform: translateX(8px);
    }

    .menu-item.active {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.2));
      color: #60a5fa;
      border-left: 4px solid #3b82f6;
    }

    /* Chat Section */
    .chat-section { 
      flex: 1; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      padding: 2rem; 
    }

    .chat-box {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 24px;
      padding: 2.5rem;
      width: 92%;
      max-width: 900px;
      box-shadow: 0 20px 60px rgba(59, 130, 246, 0.2);
      backdrop-filter: blur(10px);
    }

    .chat-box h4 { 
      font-weight: 700; 
      color: #60a5fa; 
      margin-bottom: 0.5rem; 
      font-size: 1.8rem; 
    }

    .chat-box p { 
      color: #94a3b8; 
      margin-bottom: 1.5rem; 
      font-size: 1rem; 
    }

    /* Multiselect Styles */
    .form-label {
      color: #cbd5e1;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .multiselect {
      background: rgba(30, 41, 59, 0.6);
      border: 2px solid rgba(59, 130, 246, 0.3);
      color: white;
      padding: 1rem;
      border-radius: 16px;
      width: 100%;
      position: relative;
      transition: border-color 0.3s;
    }

    .multiselect:focus-within {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .multiselect .select-box { 
      display: flex; 
      gap: 8px; 
      flex-wrap: wrap; 
      min-height: 48px; 
      align-items: center; 
      padding: 6px; 
    }

    .chip {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.2));
      border: 1px solid rgba(59, 130, 246, 0.4);
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 0.9rem;
      display: flex; 
      gap: 8px; 
      align-items: center;
      transition: all 0.2s;
    }

    .chip:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.3));
      transform: scale(1.05);
    }

    .chip i { 
      cursor: pointer; 
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .chip i:hover {
      opacity: 1;
    }

    .dropdown-panel {
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      margin-top: 8px;
      background: linear-gradient(180deg, #1e293b, #0f172a);
      z-index: 50;
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      max-height: 300px;
      overflow: auto;
      padding: 8px;
      display: none;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .dropdown-panel .symptom-item {
      display: flex; 
      gap: 12px; 
      align-items: center;
      padding: 12px; 
      border-radius: 8px; 
      cursor: pointer;
      transition: all 0.2s;
    }

    .dropdown-panel .symptom-item:hover {
      background: rgba(59, 130, 246, 0.15);
      transform: translateX(4px);
    }

    #symptomSearch {
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
      color: #e2e8f0 !important;
      padding: 8px 0 !important;
      font-size: 0.95rem;
    }

    #symptomSearch::placeholder {
      color: #64748b;
    }

    #symptomSearch:focus {
      outline: none;
    }

    /* Button Styles */
    .btn-send {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border: none;
      font-weight: 600;
      padding: 1rem 2rem;
      border-radius: 12px;
      transition: all 0.3s ease;
      font-size: 1rem;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .btn-send:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
    }

    .btn-send:disabled { 
      opacity: 0.5; 
      cursor: not-allowed;
    }

    /* Results Section */
    .result-section { 
      margin-top: 2rem; 
    }

    .result-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
      border: 1px solid rgba(59, 130, 246, 0.2);
      padding: 1.5rem;
      border-radius: 16px;
      margin-top: 1rem;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .progress { 
      height: 16px; 
      border-radius: 12px; 
      overflow: hidden; 
      background: rgba(30, 41, 59, 0.8); 
      border: 1px solid rgba(59, 130, 246, 0.2); 
    }

    .progress-bar {
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      transition: width 0.6s ease;
    }

    .shap-list { 
      margin-top: 1rem; 
    }

    .shap-row { 
      display: flex; 
      justify-content: space-between; 
      gap: 12px; 
      align-items: center; 
      padding: 10px 0; 
      border-bottom: 1px solid rgba(59, 130, 246, 0.1); 
    }

    .shap-bar { 
      height: 12px; 
      border-radius: 8px; 
      background: rgba(30, 41, 59, 0.8); 
      width: 100%; 
      margin-left: 8px; 
    }

    /* Footer */
    footer { 
      text-align: center; 
      color: #64748b; 
      font-size: 0.9rem; 
      padding: 1.5rem; 
      border-top: 1px solid rgba(59, 130, 246, 0.1); 
      margin-top: 2rem; 
    }

    /* Loading Spinner */
    .spinner-border {
      border-color: #3b82f6;
      border-right-color: transparent;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(30, 41, 59, 0.5);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.5);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(59, 130, 246, 0.7);
    }

    /* Responsive */
    @media (max-width: 700px) {
      .chat-box { 
        padding: 1.5rem; 
      }
      .navbar {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-3">
        <button class="menu-toggle btn btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideMenu">
          <i class="bi bi-list"></i>
        </button>
        <a class="navbar-brand" href="#">
          <i class="bi bi-heart-pulse-fill"></i> Health AI
        </a>
      </div>

      <div>
        <button class="btn btn-outline-light btn-sm" style="border-radius: 20px;">
          <i class="bi bi-person-circle"></i> Profile
        </button>
      </div>
    </div>
  </nav>

  <!-- Offcanvas Menu -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sideMenu">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title"><i class="bi bi-heart-pulse-fill"></i> Health AI Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body p-0">
      <ul class="menu-list">
        <li class="menu-item active">Ask AI Doctor</li>
        <li class="menu-item">Health Tracker</li>
        <li class="menu-item">Medical Reports</li>
        <li class="menu-item">Appointment History</li>
        <li class="menu-item">Settings</li>
      </ul>
    </div>
  </div>

  <div class="chat-section">
    <div class="chat-box">
      <h4><i class="bi bi-chat-dots-fill"></i> Ask Your AI Health Assistant</h4>
      <p>Select your symptoms below and click Predict to get AI-powered health insights.</p>

      <!-- Multiselect -->
      <label class="form-label">Step 1: Select Your Symptoms</label>
      <div class="multiselect" id="multiselectRoot" tabindex="0">
        <div class="select-box" id="selectedContainer">
          <span class="text-muted small">Click to select symptoms</span>
        </div>

        <div style="margin-top: 8px; border-top: 1px solid rgba(59, 130, 246, 0.2); padding-top: 8px;">
          <input id="symptomSearch" type="search" class="form-control" placeholder="ðŸ” Search symptoms..." />
        </div>

        <div class="dropdown-panel" id="dropdownPanel" role="listbox" aria-expanded="false"></div>
      </div>

      <!-- Predict button -->
      <div class="d-flex align-items-center gap-3 mt-4">
        <button class="btn-send" id="predictBtn">
          <i class="bi bi-cpu-fill"></i> Predict Disease
        </button>
        <div id="loadingSpinner" class="d-none align-items-center">
          <div class="spinner-border spinner-border-sm" role="status"></div>
          <span class="ms-2 small text-muted">Analyzing symptoms...</span>
        </div>
      </div>

      <!-- Results area -->
      <div class="result-section" id="resultSection" aria-live="polite"></div>
    </div>
  </div>

  <footer>
    <i class="bi bi-shield-check"></i> &copy; 2025 Health AI. Your trusted AI health companion.<br>
    <small>Always consult a healthcare professional for medical advice.</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ---------- Symptoms array ----------
    const SYMPTOMS = [
      "Fever",
      "Cough (Dry)",
      "Cough (Productive)",
      "Sore Throat",
      "Runny Nose",
      "Nasal Congestion",
      "Sneezing",
      "Headache (General)",
      "Headache (Throbbing)",
      "Body Aches",
      "Fatigue",
      "Chills",
      "Shortness of Breath",
      "Chest Pain (Sharp)",
      "Chest Tightness",
      "Nausea",
      "Vomiting",
      "Diarrhea",
      "Abdominal Pain (General)",
      "Abdominal Pain (Lower Right)",
      "Loss of Appetite",
      "Loss of Smell/Taste",
      "Dizziness",
      "Rash",
      "Itching",
      "Eye Redness",
      "Ear Pain"
    ];

    // ---------- State ----------
    let selectedSymptoms = new Set();

    // ---------- DOM ----------
    const dropdownPanel = document.getElementById("dropdownPanel");
    const selectedContainer = document.getElementById("selectedContainer");
    const symptomSearch = document.getElementById("symptomSearch");
    const multiselectRoot = document.getElementById("multiselectRoot");
    const predictBtn = document.getElementById("predictBtn");
    const loadingSpinner = document.getElementById("loadingSpinner");
    const resultSection = document.getElementById("resultSection");

    // ---------- Render dropdown items ----------
    function renderDropdown(filter = "") {
      dropdownPanel.innerHTML = "";
      const q = filter.trim().toLowerCase();
      const items = SYMPTOMS.filter(s => s.toLowerCase().includes(q));
      
      if (items.length === 0) {
        dropdownPanel.innerHTML = '<div style="padding:12px; text-align:center; color:#64748b;">No symptoms found</div>';
        dropdownPanel.style.display = "block";
        return;
      }
      
      items.forEach(sym => {
        const div = document.createElement("div");
        div.className = "symptom-item";
        div.tabIndex = 0;
        div.innerHTML = `
          <input type="checkbox" ${selectedSymptoms.has(sym) ? "checked" : ""} style="width:18px;height:18px;" />
          <div style="flex:1">${sym}</div>
        `;
        div.addEventListener("click", (e) => {
          if (selectedSymptoms.has(sym)) selectedSymptoms.delete(sym);
          else selectedSymptoms.add(sym);
          updateSelectedUI();
          renderDropdown(symptomSearch.value);
        });
        div.addEventListener("keydown", (e) => { if (e.key === "Enter") div.click(); });
        dropdownPanel.appendChild(div);
      });
      dropdownPanel.style.display = "block";
      dropdownPanel.setAttribute("aria-expanded", "true");
    }

    // ---------- Update "chips" ----------
    function updateSelectedUI() {
      selectedContainer.innerHTML = "";
      if (selectedSymptoms.size === 0) {
        const hint = document.createElement("span");
        hint.className = "text-muted small";
        hint.textContent = "Click to select symptoms";
        selectedContainer.appendChild(hint);
      } else {
        selectedSymptoms.forEach(sym => {
          const chip = document.createElement("div");
          chip.className = "chip";
          chip.innerHTML = `<span>${sym}</span><i class="bi bi-x-circle-fill" title="Remove"></i>`;
          chip.querySelector("i").addEventListener("click", (e) => {
            e.stopPropagation();
            selectedSymptoms.delete(sym);
            updateSelectedUI();
            renderDropdown(symptomSearch.value);
          });
          selectedContainer.appendChild(chip);
        });
      }

      predictBtn.disabled = selectedSymptoms.size === 0;
    }

    // ---------- Search handler ----------
    symptomSearch.addEventListener("input", (e) => {
      renderDropdown(e.target.value);
    });

    multiselectRoot.addEventListener("click", () => {
      symptomSearch.focus();
      renderDropdown(symptomSearch.value);
    });

    document.addEventListener("click", (e) => {
      if (!multiselectRoot.contains(e.target)) {
        dropdownPanel.style.display = "none";
      }
    });

    multiselectRoot.addEventListener("keydown", (e) => {
      if (e.key === "ArrowDown") {
        renderDropdown(symptomSearch.value);
        e.preventDefault();
      }
    });

    renderDropdown();
    updateSelectedUI();

    // ---------- Render results ----------
    function renderResults(data) {
      resultSection.innerHTML = "";

      const mainCard = document.createElement("div");
      mainCard.className = "result-card";

      const titleRow = document.createElement("div");
      titleRow.className = "d-flex align-items-center justify-content-between mb-3";
      titleRow.innerHTML = `
        <div>
          <div class="small text-muted">Predicted Condition</div>
          <div style="font-size:1.4rem; font-weight:700; color:#60a5fa; margin-top:4px;">${data.prediction}</div>
        </div>
        <div class="text-end">
          <div class="small text-muted">Confidence</div>
          <div style="font-size:1.2rem; font-weight:600; color:#3b82f6; margin-top:4px;">${Math.round(data.top3[0].confidence)}%</div>
        </div>
      `;
      mainCard.appendChild(titleRow);

      const top3Div = document.createElement("div");
      top3Div.style.marginTop = "1.5rem";
      top3Div.innerHTML = `<div class="small text-muted mb-3" style="font-weight:600;">Top 3 Possibilities</div>`;
      data.top3.forEach(item => {
        const row = document.createElement("div");
        row.style.marginBottom = "14px";
        const percent = Math.round(item.confidence);
        row.innerHTML = `
          <div class="d-flex justify-content-between small mb-2">
            <div style="font-weight:600; color:#cbd5e1;">${item.disease}</div>
            <div style="color:#60a5fa; font-weight:600;">${percent}%</div>
          </div>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width:${percent}%" aria-valuenow="${percent}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        `;
        top3Div.appendChild(row);
      });
      mainCard.appendChild(top3Div);

      const shapDiv = document.createElement("div");
      shapDiv.style.marginTop = "1.5rem";
      shapDiv.innerHTML = `<div class="small text-muted mb-3" style="font-weight:600;">Contributing Symptoms (SHAP Analysis)</div>`;

      const list = document.createElement("div");
      list.className = "shap-list";

      data.shap.forEach(item => {
        const row = document.createElement("div");
        row.className = "shap-row";
        const val = Number(item.value);
        const absVal = Math.abs(val);
        row.innerHTML = `
          <div style="width:40%; font-size:0.92rem; color:#cbd5e1;">${item.symptom}</div>
          <div style="width:60%; display:flex; align-items:center; gap:10px;">
            <div style="flex:1; display:flex; align-items:center;">
              <div class="shap-bar" style="position:relative;">
                <div style="position:absolute; left:50%; top:0; bottom:0; width:1px; background:rgba(59, 130, 246, 0.3)"></div>
                <div style="position:absolute; ${val < 0 ? 'right:50%' : 'left:50%'}; top:0; bottom:0; height:100%; width:${Math.min(absVal*200, 100)}%; background:${val < 0 ? 'linear-gradient(90deg, #ef4444, #dc2626)' : 'linear-gradient(90deg, #10b981, #059669)'}; border-radius:8px;"></div>
              </div>
            </div>
            <div style="min-width:60px; text-align:right; font-size:0.88rem; color:#94a3b8; font-family:monospace;">${val.toFixed(4)}</div>
          </div>
        `;
        list.appendChild(row);
      });

      shapDiv.appendChild(list);
      mainCard.appendChild(shapDiv);

      resultSection.appendChild(mainCard);
      mainCard.scrollIntoView({ behavior: "smooth", block: "nearest" });
    }

    // ---------- Predict API call ----------
    async function callPredict(symptomsArray) {
      if (!Array.isArray(symptomsArray) || symptomsArray.length === 0) return;

      loadingSpinner.classList.remove("d-none");
      loadingSpinner.style.display = "flex";
      predictBtn.disabled = true;

      try {
        const resp = await fetch("http://127.0.0.1:5000/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ symptoms: symptomsArray })
        });

        if (!resp.ok) {
          const txt = await resp.text();
          throw new Error(`Server error: ${resp.status} ${txt}`);
        }

        const data = await resp.json();
        renderResults(data);

      } catch (err) {
        resultSection.innerHTML = `
          <div class="result-card">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="bi bi-exclamation-triangle-fill" style="color:#ef4444; font-size:1.5rem;"></i>
              <div class="small" style="color:#ef4444; font-weight:600;">Prediction Failed</div>
            </div>
            <div class="text-muted small">${err.message}</div>
            <div class="text-muted small mt-2">Please ensure your server is running on http://127.0.0.1:5000</div>
          </div>`;
      } finally {
        loadingSpinner.classList.add("d-none");
        predictBtn.disabled = selectedSymptoms.size === 0;
      }
    }

    // ---------- Predict button handler ----------
    predictBtn.addEventListener("click", () => {
      const arr = Array.from(selectedSymptoms);
      callPredict(arr);
    });

    symptomSearch.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        if (selectedSymptoms.size > 0) callPredict(Array.from(selectedSymptoms));
      }
    });

  </script>
</body>
</html>